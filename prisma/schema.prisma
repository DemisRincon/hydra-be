generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

/* =========================
   USERS & ROLES
========================= */

model roles {
  id           String    @id @db.Uuid @default(dbgenerated("gen_random_uuid()"))
  name         role_type @unique
  display_name String
  users        users[]
}

model users {
  id         String  @id @db.Uuid @default(dbgenerated("gen_random_uuid()"))
  email      String  @unique
  username   String  @unique
  password   String?
  role_id    String  @db.Uuid
  first_name String
  last_name  String
  is_active  Boolean @default(true)

  roles      roles   @relation(fields: [role_id], references: [id])

  addresses  user_addresses[]
  carts      carts?
  orders     orders[]
  listings   listings[]
  ownedSingles singles[]
}

/* =========================
   ADDRESSES
========================= */

model user_addresses {
  id         String @id @db.Uuid @default(dbgenerated("gen_random_uuid()"))
  user_id    String @db.Uuid
  street     String
  city       String
  state      String
  zip_code   String
  country    String
  is_default Boolean @default(false)

  users         users           @relation(fields: [user_id], references: [id])
  orderShipping order_shipping[]
}

/* =========================
   CATALOG
========================= */

model categories {
  id    String @id @db.Uuid @default(dbgenerated("gen_random_uuid()"))
  name  String @unique
  order Int

  singles singles[]
}

model conditions {
  id          String @id @db.Uuid @default(dbgenerated("gen_random_uuid()"))
  code        String @unique // Condition code (NM, SP, MP, HP, DM)
  name        String @unique // Human-readable name in Spanish
  display_name String // Display name for UI

  singles singles[]
}

model languages {
  id          String @id @db.Uuid @default(dbgenerated("gen_random_uuid()"))
  code        String @unique // Language code (JP, EN, CS, CT, FR, DE, IT, KO, PT, RU, ES, AG)
  name        String @unique // Human-readable name in Spanish (Japonés, Inglés, etc.)
  display_name String // Display name for UI

  singles singles[]
}

model rarities {
  id   String @id @db.Uuid @default(dbgenerated("gen_random_uuid()"))
  name String @unique

  singles singles[]
}

/* =========================
   SINGLES
========================= */

model singles {
  id           String   @id @db.Uuid @default(dbgenerated("gen_random_uuid()"))
  name         String
  price        Decimal  @db.Decimal(10,2)
  category_id  String   @db.Uuid
  condition_id String?  @db.Uuid
  language_id  String?  @db.Uuid
  rarity_id    String?  @db.Uuid
  owner_id     String   @db.Uuid

  // Single product structure fields (matching HareruyaSearchResult JSON structure)
  borderless              Boolean  @default(false)
  cardName                String?  @map("card_name")
  cardNumber              String?
  expansion               String?
  extendedArt             Boolean  @default(false)
  finalPrice              Decimal? @db.Decimal(10,2) @map("final_price")
  foil                    Boolean  @default(false) @map("is_foil")
  hareruyaId              String?  @unique @map("hareruya_product_id")
  img                     String   @map("image_url")
  isLocalInventory        Boolean  @default(false) @map("is_local_inventory")
  link                    String?  @map("hareruya_link")
  metadata                String[] @default([])
  prerelease              Boolean  @default(false)
  premierPlay             Boolean  @default(false) @map("premier_play")
  showImportacionBadge    Boolean  @default(false) @map("show_importacion_badge")
  source                  String?  // 'hareruya' or other sources
  stock                   Int      @default(0) // Direct stock count
  surgeFoil               Boolean  @default(false) @map("surge_foil")
  variant                 String?  // Set name from brackets [SET NAME]
  
  created_at              DateTime @default(now())
  updated_at              DateTime @updatedAt

  categories categories @relation(fields: [category_id], references: [id])
  conditions conditions? @relation(fields: [condition_id], references: [id])
  languages  languages?  @relation(fields: [language_id], references: [id])
  rarities   rarities?   @relation(fields: [rarity_id], references: [id])
  owner      users       @relation(fields: [owner_id], references: [id])

  tags       single_tags[]
  stockItems stock_items[]
  cartItems  cart_items[]
  orderItems order_items[]
  listings   listings[]
}

/* =========================
   TAGS (M:N)
========================= */

model tags {
  id   String @id @db.Uuid @default(dbgenerated("gen_random_uuid()"))
  name String @unique

  singles single_tags[]
}

model single_tags {
  single_id String @db.Uuid
  tag_id     String @db.Uuid

  singles singles @relation(fields: [single_id], references: [id])
  tags     tags     @relation(fields: [tag_id], references: [id])

  @@id([single_id, tag_id])
}

/* =========================
   INVENTORY
========================= */

model stock_items {
  id         String @id @db.Uuid @default(dbgenerated("gen_random_uuid()"))
  single_id String @db.Uuid
  quantity   Int

  singles singles @relation(fields: [single_id], references: [id])
}

/* =========================
   CART
========================= */

model carts {
  id      String @id @db.Uuid @default(dbgenerated("gen_random_uuid()"))
  user_id String @unique @db.Uuid

  users users @relation(fields: [user_id], references: [id])
  items cart_items[]
}

model cart_items {
  id         String @id @db.Uuid @default(dbgenerated("gen_random_uuid()"))
  cart_id    String @db.Uuid
  single_id String @db.Uuid
  quantity   Int

  carts    carts    @relation(fields: [cart_id], references: [id])
  singles singles @relation(fields: [single_id], references: [id])
}

/* =========================
   ORDERS
========================= */

model orders {
  id         String @id @db.Uuid @default(dbgenerated("gen_random_uuid()"))
  user_id    String @db.Uuid
  status     order_status_enum
  created_at DateTime @default(now())

  users users @relation(fields: [user_id], references: [id])
  items order_items[]
  shipping order_shipping?
}

model order_items {
  id         String @id @db.Uuid @default(dbgenerated("gen_random_uuid()"))
  order_id  String @db.Uuid
  single_id String @db.Uuid
  quantity   Int
  unit_price Decimal @db.Decimal(10,2)

  orders   orders   @relation(fields: [order_id], references: [id])
  singles singles @relation(fields: [single_id], references: [id])
}

/* =========================
   SHIPPING
========================= */

model shipping_methods {
  id   String @id @db.Uuid @default(dbgenerated("gen_random_uuid()"))
  name String @unique

  orders order_shipping[]
}

model order_shipping {
  id                 String @id @db.Uuid @default(dbgenerated("gen_random_uuid()"))
  order_id           String @unique @db.Uuid
  shipping_method_id String @db.Uuid
  address_id         String @db.Uuid

  orders           orders           @relation(fields: [order_id], references: [id])
  shipping_methods shipping_methods @relation(fields: [shipping_method_id], references: [id])
  user_addresses   user_addresses   @relation(fields: [address_id], references: [id])
}

/* =========================
   LISTINGS (SELLERS)
========================= */

model listings {
  id         String @id @db.Uuid @default(dbgenerated("gen_random_uuid()"))
  user_id    String @db.Uuid
  single_id String @db.Uuid
  status     listing_status_enum

  users    users    @relation(fields: [user_id], references: [id])
  singles singles @relation(fields: [single_id], references: [id])
}

/* =========================
   ENUMS
========================= */

enum role_type {
  ADMIN
  CLIENT
  SELLER
}

enum order_status_enum {
  PENDING
  PAID
  SHIPPED
  COMPLETED
  CANCELLED
}

enum listing_status_enum {
  ACTIVE
  SOLD
  DISABLED
}
